<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2.2 Working with ACLs 2.0.1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security ACL Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/usage.html"><strong>2</strong><span>Usage</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/tutorial.html"><strong>3</strong><span>Tutorial</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../../guide/sampleApp.html"><strong>4</strong><span>Sample Application</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>ACL support for the Spring Security plugin</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security ACL Plugin</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/tutorial.html"><strong>3</strong><span>Tutorial</span> >></a></div>
                


                <div class="project">
                    <h1>2.2 Working with ACLs - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith</p>

                    <p><strong>Version:</strong> 2.0.1</p>

                    
                </div>

                

                

<h2 id="acls">2.2 Working with ACLs</h2>
<h4>Suggested application changes</h4><p class="paragraph"/>To properly display access denied exceptions (e.g. when a user tries to perform an action but doesn't have a grant authorizing it), you should create a mapping in <code>grails-app/conf/UrlMappings.groovy</code> for error code 403. In addition, it's possible to trigger a <a href="http://docs.spring.io/spring-security/site/docs/3.2.x/apidocs/org/springframework/security/acls/model/NotFoundException.html" target="blank">NotFoundException</a> which will create an error 500, but should be treated like a 403 error, so you should add mappings for these conditions:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.springframework.security.access.AccessDeniedException
<span class="java&#45;keyword">import</span> org.springframework.security.acls.model.NotFoundException<p class="paragraph"/>class UrlMappings &#123;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mappings = &#123;
      <span class="java&#45;quote">"/$controller/$action?/$id?"</span>&#123;
         constraints &#123;&#125;
      &#125;<p class="paragraph"/>      <span class="java&#45;quote">"/"</span>(view:<span class="java&#45;quote">"/index"</span>)<p class="paragraph"/>      <span class="java&#45;quote">"403"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"error403"</span>)
      <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"error500"</span>)
      <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"error403"</span>,
            exception: AccessDeniedException)
      <span class="java&#45;quote">"500"</span>(controller: <span class="java&#45;quote">"errors"</span>, action: <span class="java&#45;quote">"error403"</span>,
            exception: NotFoundException)
   &#125;
&#125;</pre></div><p class="paragraph"/>These depend on an <code>ErrorsController</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourcompany.yourapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.annotation.Secured<p class="paragraph"/>@Secured(&#91;'permitAll'&#93;)
class ErrorsController &#123;<p class="paragraph"/>   def error403() &#123;&#125;<p class="paragraph"/>   def error500() &#123;
      render view: '/error'
   &#125;
&#125;</pre></div><p class="paragraph"/>and a <code>grails-app/views/errors/error403.gsp</code> similar to this:<p class="paragraph"/><div class="code"><pre>&#60;html&#62;
&#60;head&#62;
&#60;title&#62;Access denied!&#60;/title&#62;
&#60;meta name='layout' content='main' /&#62;
&#60;/head&#62;<p class="paragraph"/>&#60;body&#62;
&#60;h1&#62;Access Denied&#60;/h1&#62;
&#60;p&#62;We're sorry, but you are not authorized to
   perform the requested operation.&#60;/p&#62;
&#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/><h4>actionSubmit</h4><p class="paragraph"/>Grails has a convenient feature where it supports multiple submit actions per form via the <code>&#60;g:actionSubmit&#62;</code> tag. This is done by posting to the <code>index</code> action but with a special parameter that indicates which action to invoke. This is a problem in general for security since any URL rules for edit, delete, save, etc. will be bypassed. It's an even more significant issue with ACLs because of the way that the access denied exception interacts with the <code>actionSubmit</code> processing. If you don't make any adjustments for this, your users will see a blank page when they attempt to submit a form and the action is disallowed. The solution is to remove <code>actionSubmit</code> buttons and replace them with regular submit buttons. This requires one form per button, and without adjusting the CSS the buttons will look differently than if they were in-line <code>actionSubmit</code> buttons, but that is fixable with the appropriate CSS changes.<p class="paragraph"/>It's simple to adjust the <code>actionSubmit</code> buttons and you'll need to change them in <code>show.gsp</code> and <code>edit.gsp</code>; <code>list.gsp</code> and <code>show.gsp</code> don't need any changes. In <code>show.gsp</code>, replace the two actionSubmit buttons with these two forms (maintain the g:message tags; the strings are hard-coded here to reduce clutter):<p class="paragraph"/><div class="code"><pre>&#60;div class=<span class="java&#45;quote">"buttons"</span>&#62;
   &#60;g:form action='edit'&#62;
      &#60;g:hiddenField name=<span class="java&#45;quote">"id"</span> value=<span class="java&#45;quote">"$&#123;reportInstance?.id&#125;"</span> /&#62;
      &#60;span class=<span class="java&#45;quote">"button"</span>&#62;
         &#60;g:submitButton class=<span class="java&#45;quote">"edit"</span> name=<span class="java&#45;quote">"Edit"</span> /&#62;
      &#60;/span&#62;
   &#60;/g:form&#62;
   &#60;g:form action='delete'&#62;
      &#60;g:hiddenField name=<span class="java&#45;quote">"id"</span> value=<span class="java&#45;quote">"$&#123;reportInstance?.id&#125;"</span> /&#62;
      &#60;span class=<span class="java&#45;quote">"button"</span>&#62;
         &#60;g:submitButton class=<span class="java&#45;quote">"delete"</span> name=<span class="java&#45;quote">"Delete"</span>
                         onclick=<span class="java&#45;quote">"<span class="java&#45;keyword">return</span> confirm('Are you sure?');"</span> /&#62;
      &#60;/span&#62;
   &#60;/g:form&#62;
&#60;/div&#62;</pre></div><p class="paragraph"/>In <code>edit.gsp</code>, change the <code>&#60;form&#62;</code> tag to<p class="paragraph"/><div class="code"><pre>&#60;g:form action='update'&#62;</pre></div><p class="paragraph"/>and convert the update button to a regular submit button:<p class="paragraph"/><div class="code"><pre>&#60;div class=<span class="java&#45;quote">"buttons"</span>&#62;
   &#60;span class=<span class="java&#45;quote">"button"</span>&#62;
      &#60;g:submitButton class=<span class="java&#45;quote">"save"</span> name=<span class="java&#45;quote">"Update"</span> /&#62;
   &#60;/span&#62;
&#60;/div&#62;</pre></div><p class="paragraph"/>and move the delete button out of the form into its own form just below the main form:<p class="paragraph"/><div class="code"><pre>&#60;g:form action='delete'&#62;
   &#60;g:hiddenField name=<span class="java&#45;quote">"id"</span> value=<span class="java&#45;quote">"$&#123;reportInstance?.id&#125;"</span> /&#62;
   &#60;div class=<span class="java&#45;quote">"buttons"</span>&#62;
      &#60;span class=<span class="java&#45;quote">"button"</span>&#62;
         &#60;g:submitButton class=<span class="java&#45;quote">"delete"</span> name=<span class="java&#45;quote">"Delete"</span>
                         onclick=<span class="java&#45;quote">"<span class="java&#45;keyword">return</span> confirm('Are you sure?');"</span> /&#62;
      &#60;/span&#62;
   &#60;/div&#62;
&#60;/g:form&#62;</pre></div>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security ACL Plugin</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/tutorial.html"><strong>3</strong><span>Tutorial</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">AclUtilService</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/AclUtilService/addPermission.html">addPermission</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/AclUtilService/changeOwner.html">changeOwner</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/AclUtilService/deleteAcl.html">deleteAcl</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/AclUtilService/deletePermission.html">deletePermission</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/AclUtilService/hasPermission.html">hasPermission</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/AclUtilService/readAcl.html">readAcl</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Scripts/s2-create-acl-domains.html">s2-create-acl-domains</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tag Libraries</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/notPermitted.html">notPermitted</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Tag%20Libraries/permitted.html">permitted</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
